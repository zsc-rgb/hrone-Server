# ğŸ“ ç¬¬6é˜¶æ®µå‡†å¤‡å·¥ä½œï¼ˆå®‰å…¨è®¤è¯ï¼‰

> ç›®æ ‡ï¼šå®Œæˆ 6.1 JWT å·¥å…·ç±»çš„å­¦ä¹ ä¸æ¥å…¥å‡†å¤‡

---

## 1. ä¾èµ–ä¸ä»£ç 

- å·²æ·»åŠ ä¾èµ–ï¼š`io.jsonwebtoken:jjwt`
- å·²æ–°å¢å·¥å…·ç±»ï¼š`hrone-framework` â†’ `com.hrone.framework.security.jwt.JwtUtils`
  - ç”Ÿæˆ Tokenï¼š`JwtUtils.generateToken(subject, claims, secret, expireMs)`
  - è§£æ Tokenï¼š`JwtUtils.parseClaims(token, secret)`
  - è·å–ä¸»ä½“ï¼š`JwtUtils.getSubject(token, secret)`
  - éªŒè¯æœ‰æ•ˆæ€§ï¼š`JwtUtils.validateToken(token, secret)`

---

## 2. é…ç½®é¡¹ï¼ˆå»ºè®®ï¼‰

æ–‡ä»¶ï¼š`hrone-admin/src/main/resources/application-dev.yml`

```yaml
jwt:
  secret: HROne-Dev-Secret-Key-ChangeMe-For-Production-Use
  expire-minutes: 120
```

è¯´æ˜ï¼š
- å¼€å‘ç¯å¢ƒå¯ä½¿ç”¨ç¤ºä¾‹å¯†é’¥ï¼›ç”Ÿäº§ç¯å¢ƒè¯·æ”¾å…¥å®‰å…¨çš„é…ç½®ä¸­å¿ƒã€‚
- è¿‡æœŸæ—¶é—´å•ä½ä¸ºåˆ†é’Ÿã€‚

---

## 3. å¿«é€Ÿè‡ªæµ‹

åœ¨ä»»æ„æµ‹è¯•ç±»æˆ–æ§åˆ¶å°ä¸­æ‰§è¡Œï¼ˆç¤ºæ„ä¼ªä»£ç ï¼‰ï¼š

```java
String token = JwtUtils.generateToken("admin", null, null, -1); // ä½¿ç”¨é»˜è®¤å¯†é’¥ä¸2å°æ—¶è¿‡æœŸ
System.out.println("token=" + token);
System.out.println("valid=" + JwtUtils.validateToken(token, null));
System.out.println("subject=" + JwtUtils.getSubject(token, null));
```

é¢„æœŸï¼š
- æ‰“å°å‡ºå¯è§£æçš„ Token
- `valid` ä¸º `true`
- `subject` ä¸º `admin`

---

## 4. ä¸‹ä¸€æ­¥ï¼ˆ6.2 ç™»å½•åŠŸèƒ½ï¼‰

- åˆ›å»º `AuthController`ï¼šæ¥æ”¶ç”¨æˆ·å/å¯†ç ï¼ŒéªŒè¯åç­¾å‘ Token å¹¶è¿”å›ï¼ˆå·²å®Œæˆï¼‰
- ç»“åˆæ•°æ®åº“çš„ `sys_user` è¡¨è¿›è¡Œå¯†ç æ ¡éªŒï¼ˆå½“å‰ä¸ºæ˜æ–‡æ¼”ç¤ºï¼Œåç»­åˆ‡æ¢åŠ å¯†ï¼‰
- è¿”å›ç»“æ„ä¸­åŒ…å« `token`ã€è¿‡æœŸæ—¶é—´ç­‰ä¿¡æ¯ï¼ˆå·²å®Œæˆï¼‰

### è°ƒç”¨ç¤ºä¾‹

```
POST http://localhost:8080/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123"
}
```

æˆåŠŸå“åº”ï¼š
```json
{
  "code": 200,
  "msg": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9....",
    "expireMinutes": 120,
    "userId": 1,
    "userName": "admin",
    "nickName": "ç®¡ç†å‘˜"
  }
}
```

---

## 5. 6.3 è¿‡æ»¤å™¨ä¸ 6.4 æƒé™ï¼ˆä½¿ç”¨æŒ‡å—ï¼‰

### è¿‡æ»¤å™¨ï¼ˆJwtAuthenticationFilterï¼‰
- ç”Ÿæ•ˆèŒƒå›´ï¼šå…¨å±€ `/*`
- ç™½åå•ï¼š`/auth/**`ã€`/test/**`ã€`/druid/**`ã€`/actuator/**`
- æˆåŠŸåï¼šåœ¨ `request` æ”¾ç½® `login_user_key`ï¼ˆç”¨æˆ·IDï¼‰
- å¤±è´¥æ—¶ï¼šè¿”å› `401` JSON

### æƒé™æ³¨è§£ï¼ˆæ¼”ç¤ºï¼‰
- æ³¨è§£ï¼š`@RequiresPermissions({"system:user:list"})`
- ä¼ å…¥æƒé™ï¼šè¯·æ±‚å¤´ `X-Perms: system:user:list,system:user:add`
- ä¸æ»¡è¶³æ—¶ï¼šæŠ›å‡º 403ï¼ˆServiceExceptionï¼‰

---

åŠ æ²¹ï¼å®Œæˆ 6.1 åï¼Œæˆ‘ä»¬å°†ç»§ç»­å®ç°ç™»å½•ä¸æ‹¦æˆªå™¨/è¿‡æ»¤å™¨æ ¡éªŒã€‚ğŸš€


