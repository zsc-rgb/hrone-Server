# ğŸ§ª ç¬¬2.4é˜¶æ®µ - å¼‚å¸¸å¤„ç†æµ‹è¯•æŒ‡å—

## âœ… å·²å®Œæˆå†…å®¹æ€»è§ˆ

### å¼‚å¸¸å¤„ç†æ¨¡å— âœ…
- `BaseException` - åŸºç¡€å¼‚å¸¸ç±»ï¼ˆ185è¡Œï¼‰
- `ServiceException` - ä¸šåŠ¡å¼‚å¸¸ï¼ˆ149è¡Œï¼‰
- `GlobalExceptionHandler` - å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼ˆ173è¡Œï¼‰
- `ExceptionTestController` - å¼‚å¸¸æµ‹è¯•æ¥å£ï¼ˆ201è¡Œï¼‰
- `StringUtils æ‰©å±•` - æ·»åŠ  join() æ–¹æ³•

---

## ğŸ§ª æµ‹è¯•æ¥å£

### å¼‚å¸¸æµ‹è¯•æ¥å£æ€»è§ˆ

**è®¿é—®ï¼š** `GET http://localhost:8080/test/exception`

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "msg": "å¼‚å¸¸å¤„ç†æµ‹è¯•æ¥å£åˆ—è¡¨",
  "data": {
    "ä¸šåŠ¡å¼‚å¸¸ï¼ˆé»˜è®¤500ï¼‰": "GET /test/exception/service",
    "ä¸šåŠ¡å¼‚å¸¸ï¼ˆè‡ªå®šä¹‰403ï¼‰": "GET /test/exception/service403",
    "ç©ºæŒ‡é’ˆå¼‚å¸¸": "GET /test/exception/nullpointer",
    "æ•°ç»„è¶Šç•Œå¼‚å¸¸": "GET /test/exception/arrayindex",
    "é™¤é›¶å¼‚å¸¸": "GET /test/exception/arithmetic",
    "ç±»å‹è½¬æ¢å¼‚å¸¸": "GET /test/exception/classcast",
    "æ­£å¸¸ä¸šåŠ¡æµ‹è¯•": "GET /test/exception/normal/{id}",
    "å¼‚å¸¸é“¾æµ‹è¯•": "GET /test/exception/chain"
  }
}
```

---

### 1ï¸âƒ£ ä¸šåŠ¡å¼‚å¸¸æµ‹è¯•ï¼ˆé»˜è®¤500ï¼‰

**æ¥å£ï¼š** `GET http://localhost:8080/test/exception/service`

**æµ‹è¯•åœºæ™¯ï¼š** ç”¨æˆ·åå·²å­˜åœ¨

**ä»£ç ï¼š**
```java
throw new ServiceException("ç”¨æˆ·åå·²å­˜åœ¨");
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 500,
  "msg": "ç”¨æˆ·åå·²å­˜åœ¨"
}
```

**æµ‹è¯•è¦ç‚¹ï¼š**
- âœ… å¼‚å¸¸è¢«å…¨å±€å¤„ç†å™¨æ•è·
- âœ… è½¬æ¢ä¸ºç»Ÿä¸€çš„ AjaxResult æ ¼å¼
- âœ… code=500ï¼ˆé»˜è®¤é”™è¯¯ç ï¼‰
- âœ… msg ä¸ºå¼‚å¸¸æ¶ˆæ¯
- âœ… åç«¯æ§åˆ¶å°æœ‰æ—¥å¿—è®°å½•

---

### 2ï¸âƒ£ ä¸šåŠ¡å¼‚å¸¸æµ‹è¯•ï¼ˆè‡ªå®šä¹‰403ï¼‰

**æ¥å£ï¼š** `GET http://localhost:8080/test/exception/service403`

**æµ‹è¯•åœºæ™¯ï¼š** æƒé™ä¸è¶³

**ä»£ç ï¼š**
```java
throw new ServiceException("æ²¡æœ‰æƒé™è®¿é—®è¯¥èµ„æº", 403);
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 403,
  "msg": "æ²¡æœ‰æƒé™è®¿é—®è¯¥èµ„æº"
}
```

**æµ‹è¯•è¦ç‚¹ï¼š**
- âœ… æ”¯æŒè‡ªå®šä¹‰é”™è¯¯ç 
- âœ… code=403ï¼ˆè‡ªå®šä¹‰ï¼‰
- âœ… å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚è®¾ç½®ä¸åŒçš„é”™è¯¯ç 

---

### 3ï¸âƒ£ ç©ºæŒ‡é’ˆå¼‚å¸¸æµ‹è¯•

**æ¥å£ï¼š** `GET http://localhost:8080/test/exception/nullpointer`

**æµ‹è¯•åœºæ™¯ï¼š** ç¨‹åºå‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸

**ä»£ç ï¼š**
```java
String str = null;
return AjaxResult.success(str.length());  // æŠ›å‡º NullPointerException
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 500,
  "msg": "ç³»ç»Ÿè¿è¡Œå¼‚å¸¸ï¼šNullPointerExceptionï¼Œè¯·è”ç³»ç®¡ç†å‘˜"
}
```

**æµ‹è¯•è¦ç‚¹ï¼š**
- âœ… è¿è¡Œæ—¶å¼‚å¸¸è¢«æ•è·
- âœ… ä¸ä¼šè¿”å›500é”™è¯¯é¡µé¢
- âœ… è¿”å›ç»Ÿä¸€çš„JSONæ ¼å¼
- âœ… ä¸æš´éœ²è¯¦ç»†çš„å¼‚å¸¸å †æ ˆï¼ˆå®‰å…¨ï¼‰

---

### 4ï¸âƒ£ æ•°ç»„è¶Šç•Œå¼‚å¸¸æµ‹è¯•

**æ¥å£ï¼š** `GET http://localhost:8080/test/exception/arrayindex`

**æµ‹è¯•åœºæ™¯ï¼š** è®¿é—®æ•°ç»„æ—¶è¶Šç•Œ

**ä»£ç ï¼š**
```java
int[] arr = {1, 2, 3};
return AjaxResult.success(arr[10]);  // æ•°ç»„åªæœ‰3ä¸ªå…ƒç´ 
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 500,
  "msg": "ç³»ç»Ÿè¿è¡Œå¼‚å¸¸ï¼šArrayIndexOutOfBoundsExceptionï¼Œè¯·è”ç³»ç®¡ç†å‘˜"
}
```

---

### 5ï¸âƒ£ é™¤é›¶å¼‚å¸¸æµ‹è¯•

**æ¥å£ï¼š** `GET http://localhost:8080/test/exception/arithmetic`

**æµ‹è¯•åœºæ™¯ï¼š** é™¤ä»¥é›¶

**ä»£ç ï¼š**
```java
int result = 10 / 0;  // é™¤ä»¥0
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 500,
  "msg": "ç³»ç»Ÿè¿è¡Œå¼‚å¸¸ï¼šArithmeticExceptionï¼Œè¯·è”ç³»ç®¡ç†å‘˜"
}
```

---

### 6ï¸âƒ£ ç±»å‹è½¬æ¢å¼‚å¸¸æµ‹è¯•

**æ¥å£ï¼š** `GET http://localhost:8080/test/exception/classcast`

**æµ‹è¯•åœºæ™¯ï¼š** é”™è¯¯çš„ç±»å‹è½¬æ¢

**ä»£ç ï¼š**
```java
Object obj = "å­—ç¬¦ä¸²";
Integer num = (Integer) obj;  // æ— æ³•å°†Stringè½¬ä¸ºInteger
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 500,
  "msg": "ç³»ç»Ÿè¿è¡Œå¼‚å¸¸ï¼šClassCastExceptionï¼Œè¯·è”ç³»ç®¡ç†å‘˜"
}
```

---

### 7ï¸âƒ£ æ­£å¸¸ä¸šåŠ¡æµ‹è¯•ï¼ˆå¯¹æ¯”ï¼‰

**æ¥å£ï¼š** `GET http://localhost:8080/test/exception/normal/{id}`

**æµ‹è¯•åœºæ™¯ï¼š** æ¨¡æ‹ŸçœŸå®ä¸šåŠ¡ä¸­çš„å¼‚å¸¸å¤„ç†

**æµ‹è¯•ç”¨ä¾‹ï¼š**

**ç”¨ä¾‹1ï¼šIDéæ³•ï¼ˆid=0ï¼‰**
```
GET /test/exception/normal/0

å“åº”ï¼š
{
  "code": 400,
  "msg": "ç”¨æˆ·IDå¿…é¡»å¤§äº0"
}
```

**ç”¨ä¾‹2ï¼šç”¨æˆ·ä¸å­˜åœ¨ï¼ˆid=9999ï¼‰**
```
GET /test/exception/normal/9999

å“åº”ï¼š
{
  "code": 404,
  "msg": "ç”¨æˆ·ä¸å­˜åœ¨"
}
```

**ç”¨ä¾‹3ï¼šæ­£å¸¸æŸ¥è¯¢ï¼ˆid=100ï¼‰**
```
GET /test/exception/normal/100

å“åº”ï¼š
{
  "code": 200,
  "msg": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "userId": 100,
    "userName": "ç”¨æˆ·100",
    "status": "æ­£å¸¸"
  }
}
```

**æµ‹è¯•è¦ç‚¹ï¼š**
- âœ… ä¸šåŠ¡å¼‚å¸¸ä½¿ç”¨ ServiceException
- âœ… æ ¹æ®ä¸åŒé”™è¯¯è®¾ç½®ä¸åŒé”™è¯¯ç 
- âœ… æ­£å¸¸æµç¨‹è¿”å›æˆåŠŸæ•°æ®

---

### 8ï¸âƒ£ å¼‚å¸¸é“¾æµ‹è¯•

**æ¥å£ï¼š** `GET http://localhost:8080/test/exception/chain`

**æµ‹è¯•åœºæ™¯ï¼š** åº•å±‚å¼‚å¸¸è¢«åŒ…è£…æˆä¸šåŠ¡å¼‚å¸¸

**ä»£ç ï¼š**
```java
try {
    int result = 10 / 0;  // åº•å±‚æŠ›å‡º ArithmeticException
} catch (Exception e) {
    // åŒ…è£…æˆä¸šåŠ¡å¼‚å¸¸
    throw new ServiceException("æ•°æ®å¤„ç†å¤±è´¥", 500, e.getMessage());
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 500,
  "msg": "æ•°æ®å¤„ç†å¤±è´¥"
}
```

**æµ‹è¯•è¦ç‚¹ï¼š**
- âœ… åº•å±‚å¼‚å¸¸è¢«åŒ…è£…
- âœ… è¿”å›æ›´å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
- âœ… è¯¦ç»†é”™è¯¯ä¿¡æ¯è®°å½•åœ¨detailMessageä¸­

---

## ğŸ“Š å¼‚å¸¸å¤„ç†æ¶æ„

### å¼‚å¸¸å±‚æ¬¡ç»“æ„

```
Throwable
  â”œâ”€â”€ Errorï¼ˆé”™è¯¯ï¼Œä¸éœ€è¦æ•è·ï¼‰
  â””â”€â”€ Exception
      â”œâ”€â”€ CheckedExceptionï¼ˆæ£€æŸ¥å¼‚å¸¸ï¼Œå¿…é¡»å¤„ç†ï¼‰
      â””â”€â”€ RuntimeExceptionï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼‰
          â”œâ”€â”€ BaseExceptionï¼ˆæˆ‘ä»¬çš„åŸºç¡€å¼‚å¸¸ï¼‰â­
          â”‚   â””â”€â”€ ServiceExceptionï¼ˆä¸šåŠ¡å¼‚å¸¸ï¼‰â­
          â”œâ”€â”€ NullPointerException
          â”œâ”€â”€ ArrayIndexOutOfBoundsException
          â””â”€â”€ ...
```

**è®¾è®¡è¯´æ˜ï¼š**
- âœ… ç»§æ‰¿ RuntimeExceptionï¼Œä¸éœ€è¦å¼ºåˆ¶ catch
- âœ… BaseException ä½œä¸ºæ‰€æœ‰è‡ªå®šä¹‰å¼‚å¸¸çš„çˆ¶ç±»
- âœ… ServiceException ç”¨äºä¸šåŠ¡é€»è¾‘å¼‚å¸¸

---

### å¼‚å¸¸å¤„ç†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Controller å±‚                        â”‚
â”‚  â”œâ”€â”€ ä¸šåŠ¡å¤„ç†                         â”‚
â”‚  â””â”€â”€ æŠ›å‡ºå¼‚å¸¸ï¼ˆä¸éœ€è¦catchï¼‰           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GlobalExceptionHandler              â”‚
â”‚  â”œâ”€â”€ @ExceptionHandler æ•è·å¼‚å¸¸       â”‚
â”‚  â”œâ”€â”€ åˆ¤æ–­å¼‚å¸¸ç±»å‹                     â”‚
â”‚  â”œâ”€â”€ è½¬æ¢ä¸º AjaxResult                â”‚
â”‚  â””â”€â”€ è®°å½•æ—¥å¿—                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»Ÿä¸€å“åº”                             â”‚
â”‚  { code: 500, msg: "é”™è¯¯ä¿¡æ¯" }       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### å¼‚å¸¸å¤„ç†ä¼˜å…ˆçº§

GlobalExceptionHandler æŒ‰ç…§ä»¥ä¸‹é¡ºåºå¤„ç†å¼‚å¸¸ï¼š

1. **ServiceExceptionï¼ˆä¸šåŠ¡å¼‚å¸¸ï¼‰** - æœ€é«˜ä¼˜å…ˆçº§
   - è¿”å›è‡ªå®šä¹‰çš„é”™è¯¯ç å’Œæ¶ˆæ¯

2. **BindExceptionï¼ˆå‚æ•°æ ¡éªŒå¼‚å¸¸ï¼‰**
   - è¿”å›400ï¼Œå‚æ•°é”™è¯¯

3. **MethodArgumentNotValidExceptionï¼ˆæ–¹æ³•å‚æ•°æ ¡éªŒå¼‚å¸¸ï¼‰**
   - è¿”å›400ï¼ŒJSONå‚æ•°é”™è¯¯

4. **HttpRequestMethodNotSupportedExceptionï¼ˆè¯·æ±‚æ–¹æ³•å¼‚å¸¸ï¼‰**
   - è¿”å›405ï¼Œæ–¹æ³•ä¸æ”¯æŒ

5. **RuntimeExceptionï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼‰**
   - è¿”å›500ï¼Œç³»ç»Ÿè¿è¡Œå¼‚å¸¸

6. **Exceptionï¼ˆç³»ç»Ÿå¼‚å¸¸ï¼‰** - å…œåº•å¼‚å¸¸
   - è¿”å›500ï¼Œç³»ç»Ÿå†…éƒ¨é”™è¯¯

---

## ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯1ï¼šç”¨æˆ·ç™»å½•

```java
@PostMapping("/login")
public AjaxResult login(@RequestBody LoginBody loginBody) {
    // éªŒè¯ç”¨æˆ·å
    User user = userService.selectUserByUserName(loginBody.getUsername());
    if (user == null) {
        // æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸ï¼Œç”±å…¨å±€å¤„ç†å™¨æ•è·
        throw new ServiceException("ç”¨æˆ·ä¸å­˜åœ¨");
    }
    
    // éªŒè¯å¯†ç 
    if (!passwordMatch(loginBody.getPassword(), user.getPassword())) {
        throw new ServiceException("å¯†ç é”™è¯¯");
    }
    
    // æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
    if ("ç¦ç”¨".equals(user.getStatus())) {
        throw new ServiceException("ç”¨æˆ·å·²è¢«ç¦ç”¨ï¼Œè¯·è”ç³»ç®¡ç†å‘˜", 403);
    }
    
    // ç”ŸæˆToken
    String token = tokenService.createToken(user);
    return AjaxResult.success("ç™»å½•æˆåŠŸ").put("token", token);
}
```

**ä¼˜ç‚¹ï¼š**
- âœ… ä¸éœ€è¦åœ¨æ¯ä¸ªåœ°æ–¹å†™ try-catch
- âœ… ä»£ç æ›´æ¸…æ™°ï¼Œä¸“æ³¨äºä¸šåŠ¡é€»è¾‘
- âœ… å¼‚å¸¸ç»Ÿä¸€å¤„ç†ï¼Œå“åº”æ ¼å¼ä¸€è‡´

---

### åœºæ™¯2ï¼šç”¨æˆ·æ³¨å†Œ

```java
@PostMapping("/register")
public AjaxResult register(@RequestBody User user) {
    // éªŒè¯ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
    if (userService.checkUserNameUnique(user.getUserName())) {
        throw new ServiceException("ç”¨æˆ·åå·²å­˜åœ¨");
    }
    
    // éªŒè¯æ‰‹æœºå·æ˜¯å¦å·²å­˜åœ¨
    if (userService.checkPhoneUnique(user.getPhone())) {
        throw new ServiceException("æ‰‹æœºå·å·²è¢«æ³¨å†Œ");
    }
    
    // éªŒè¯é‚®ç®±æ˜¯å¦å·²å­˜åœ¨
    if (userService.checkEmailUnique(user.getEmail())) {
        throw new ServiceException("é‚®ç®±å·²è¢«æ³¨å†Œ");
    }
    
    // æ³¨å†Œç”¨æˆ·
    userService.registerUser(user);
    return AjaxResult.success("æ³¨å†ŒæˆåŠŸ");
}
```

---

### åœºæ™¯3ï¼šæ•°æ®åˆ é™¤

```java
@DeleteMapping("/{id}")
public AjaxResult remove(@PathVariable Long id) {
    // éªŒè¯æ˜¯å¦ä¸ºç³»ç»Ÿå†…ç½®æ•°æ®
    User user = userService.selectUserById(id);
    if (user.getUserId() == 1L) {
        throw new ServiceException("ç³»ç»Ÿå†…ç½®ç”¨æˆ·ä¸å…è®¸åˆ é™¤", 403);
    }
    
    // æ£€æŸ¥æ˜¯å¦æœ‰å…³è”æ•°æ®
    if (userService.hasRelatedData(id)) {
        throw new ServiceException("è¯¥ç”¨æˆ·å­˜åœ¨å…³è”æ•°æ®ï¼Œæ— æ³•åˆ é™¤");
    }
    
    // åˆ é™¤ç”¨æˆ·
    int rows = userService.deleteUserById(id);
    return toAjax(rows);
}
```

---

### åœºæ™¯4ï¼šService å±‚å¼‚å¸¸å¤„ç†

```java
@Service
public class UserServiceImpl implements UserService {
    
    @Override
    public User selectUserById(Long userId) {
        if (userId == null || userId <= 0) {
            throw new ServiceException("ç”¨æˆ·IDä¸èƒ½ä¸ºç©º", 400);
        }
        
        User user = userMapper.selectUserById(userId);
        if (user == null) {
            throw new ServiceException("ç”¨æˆ·ä¸å­˜åœ¨", 404);
        }
        
        return user;
    }
    
    @Override
    public int insertUser(User user) {
        try {
            return userMapper.insert(user);
        } catch (DuplicateKeyException e) {
            // æ•°æ®åº“å”¯ä¸€é”®å†²çª
            throw new ServiceException("ç”¨æˆ·åå·²å­˜åœ¨");
        } catch (Exception e) {
            // å…¶ä»–æ•°æ®åº“å¼‚å¸¸
            log.error("æ’å…¥ç”¨æˆ·å¤±è´¥", e);
            throw new ServiceException("æ·»åŠ ç”¨æˆ·å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•");
        }
    }
}
```

---

## ğŸ” æ ¸å¿ƒæ¦‚å¿µè§£æ

### 1. ä¸ºä»€ä¹ˆä¸åœ¨ Controller ä¸­ catch å¼‚å¸¸ï¼Ÿ

**âŒ ä¸æ¨èçš„å†™æ³•ï¼š**
```java
@GetMapping("/{id}")
public AjaxResult getUser(@PathVariable Long id) {
    try {
        User user = userService.getUserById(id);
        return AjaxResult.success(user);
    } catch (Exception e) {
        return AjaxResult.error(e.getMessage());
    }
}
```

**âœ… æ¨èçš„å†™æ³•ï¼š**
```java
@GetMapping("/{id}")
public AjaxResult getUser(@PathVariable Long id) {
    User user = userService.getUserById(id);  // å¼‚å¸¸ç›´æ¥æŠ›å‡º
    return AjaxResult.success(user);
}
```

**ç†ç”±ï¼š**
- ä»£ç æ›´ç®€æ´ï¼Œä¸“æ³¨ä¸šåŠ¡é€»è¾‘
- å¼‚å¸¸ç»Ÿä¸€å¤„ç†ï¼Œé¿å…é‡å¤ä»£ç 
- å…¨å±€è®°å½•æ—¥å¿—ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥

---

### 2. ServiceException vs Exception

**ä½¿ç”¨ ServiceExceptionï¼š**
```java
// å¯é¢„è§çš„ä¸šåŠ¡å¼‚å¸¸
if (user == null) {
    throw new ServiceException("ç”¨æˆ·ä¸å­˜åœ¨");
}

// æƒé™ä¸è¶³
if (!hasPermission()) {
    throw new ServiceException("æƒé™ä¸è¶³", 403);
}
```

**ä½¿ç”¨ Exceptionï¼š**
```java
// ä¸å¯é¢„è§çš„ç³»ç»Ÿå¼‚å¸¸
try {
    // æ•°æ®åº“æ“ä½œ
} catch (SQLException e) {
    throw new Exception("æ•°æ®åº“æ“ä½œå¤±è´¥", e);
}
```

**åŒºåˆ«ï¼š**
- ServiceExceptionï¼šä¸šåŠ¡å¼‚å¸¸ï¼Œå¯é¢„è§çš„é”™è¯¯
- Exceptionï¼šç³»ç»Ÿå¼‚å¸¸ï¼Œä¸å¯é¢„è§çš„é”™è¯¯

---

### 3. å¼‚å¸¸æ—¥å¿—è®°å½•

**GlobalExceptionHandler è‡ªåŠ¨è®°å½•æ—¥å¿—ï¼š**

```java
@ExceptionHandler(ServiceException.class)
public AjaxResult handleServiceException(ServiceException e) {
    log.error("ä¸šåŠ¡å¼‚å¸¸ï¼š{}", e.getMessage());  // è®°å½•æ—¥å¿—
    return AjaxResult.error(e.getCode(), e.getMessage());
}
```

**æ—¥å¿—è¾“å‡ºç¤ºä¾‹ï¼š**
```
2025-11-05 19:45:00 [http-nio-8080-exec-1] ERROR c.h.f.e.GlobalExceptionHandler - ä¸šåŠ¡å¼‚å¸¸ï¼šç”¨æˆ·åå·²å­˜åœ¨
```

**å¥½å¤„ï¼š**
- ä¾¿äºé—®é¢˜æ’æŸ¥
- è®°å½•å¼‚å¸¸å‘ç”Ÿçš„æ—¶é—´å’Œçº¿ç¨‹
- ç”Ÿäº§ç¯å¢ƒå¯ä»¥æŸ¥çœ‹æ—¥å¿—å®šä½é—®é¢˜

---

### 4. å‰ç«¯å¦‚ä½•å¤„ç†å¼‚å¸¸å“åº”

**Axios å“åº”æ‹¦æˆªå™¨ï¼š**
```javascript
// src/utils/request.ts
service.interceptors.response.use(
  (res) => {
    const code = res.data.code || 200;
    const msg = res.data.msg || 'æ“ä½œæˆåŠŸ';
    
    if (code !== 200) {
      // æ˜¾ç¤ºé”™è¯¯æç¤º
      ElMessage.error(msg);
      return Promise.reject(new Error(msg));
    }
    
    return res.data;
  },
  (error) => {
    // ç½‘ç»œé”™è¯¯
    ElMessage.error('åç«¯æ¥å£è¿æ¥å¼‚å¸¸');
    return Promise.reject(error);
  }
)
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```javascript
// è°ƒç”¨æ¥å£
deleteUser(userId).then(() => {
  ElMessage.success('åˆ é™¤æˆåŠŸ');
  getList();  // åˆ·æ–°åˆ—è¡¨
}).catch(error => {
  // å¼‚å¸¸å·²ç»åœ¨æ‹¦æˆªå™¨ä¸­å¤„ç†ï¼ˆæ˜¾ç¤ºæ¶ˆæ¯ï¼‰
  // è¿™é‡Œå¯ä»¥åšä¸€äº›é¢å¤–å¤„ç†
});
```

---

## ğŸ“– æœ€ä½³å®è·µ

### 1. å¼‚å¸¸å‘½åè§„èŒƒ

```java
// âœ… å¥½çš„å‘½å
throw new ServiceException("ç”¨æˆ·åå·²å­˜åœ¨");
throw new ServiceException("æƒé™ä¸è¶³");
throw new ServiceException("è¯¥æ•°æ®å·²è¢«å¼•ç”¨ï¼Œæ— æ³•åˆ é™¤");

// âŒ ä¸å¥½çš„å‘½å
throw new ServiceException("error");  // å¤ªç®€å•
throw new ServiceException("å‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯");  // ä¸æ˜ç¡®
```

---

### 2. é”™è¯¯ç ä½¿ç”¨è§„èŒƒ

```java
// 400 - è¯·æ±‚å‚æ•°é”™è¯¯
throw new ServiceException("ç”¨æˆ·IDä¸èƒ½ä¸ºç©º", 400);

// 403 - æƒé™ä¸è¶³
throw new ServiceException("æ²¡æœ‰æƒé™è®¿é—®è¯¥èµ„æº", 403);

// 404 - èµ„æºä¸å­˜åœ¨
throw new ServiceException("ç”¨æˆ·ä¸å­˜åœ¨", 404);

// 500 - æœåŠ¡å™¨é”™è¯¯ï¼ˆé»˜è®¤ï¼‰
throw new ServiceException("æ“ä½œå¤±è´¥");

// 601 - è‡ªå®šä¹‰è­¦å‘Š
throw new ServiceException("è¯¥æ“ä½œéœ€è¦äººå·¥å®¡æ ¸", 601);
```

---

### 3. å¼‚å¸¸ä¸æ—¥å¿—çš„å…³ç³»

```java
@Service
public class UserServiceImpl {
    
    private static final Logger log = LoggerFactory.getLogger(UserServiceImpl.class);
    
    public User getUserById(Long id) {
        if (id == null) {
            // å‚æ•°é”™è¯¯ï¼Œä¸éœ€è¦è®°å½•æ—¥å¿—
            throw new ServiceException("ç”¨æˆ·IDä¸èƒ½ä¸ºç©º", 400);
        }
        
        User user = userMapper.selectById(id);
        if (user == null) {
            // ç”¨æˆ·ä¸å­˜åœ¨ï¼Œä¸éœ€è¦è®°å½•æ—¥å¿—ï¼ˆæ­£å¸¸ä¸šåŠ¡åœºæ™¯ï¼‰
            throw new ServiceException("ç”¨æˆ·ä¸å­˜åœ¨", 404);
        }
        
        return user;
    }
    
    public void deleteUser(Long id) {
        try {
            userMapper.deleteById(id);
        } catch (DataAccessException e) {
            // æ•°æ®åº“å¼‚å¸¸ï¼Œéœ€è¦è®°å½•è¯¦ç»†æ—¥å¿—
            log.error("åˆ é™¤ç”¨æˆ·å¤±è´¥ï¼ŒuserId={}", id, e);
            throw new ServiceException("åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•");
        }
    }
}
```

**åŸåˆ™ï¼š**
- âœ… ä¸šåŠ¡å¼‚å¸¸ä¸éœ€è¦åœ¨Serviceå±‚è®°å½•æ—¥å¿—ï¼ˆå…¨å±€å¤„ç†å™¨ä¼šè®°å½•ï¼‰
- âœ… ç³»ç»Ÿå¼‚å¸¸éœ€è¦åœ¨å‘ç”Ÿå¤„è®°å½•è¯¦ç»†æ—¥å¿—
- âœ… æ—¥å¿—çº§åˆ«ï¼šerrorï¼ˆé”™è¯¯ï¼‰ã€warnï¼ˆè­¦å‘Šï¼‰ã€infoï¼ˆä¿¡æ¯ï¼‰

---

## ğŸ§ª å®Œæ•´æµ‹è¯•æµç¨‹

### 1. å¯åŠ¨é¡¹ç›®

```bash
cd d:\HroneWorking\hrone-Server
mvn spring-boot:run -pl hrone-admin
```

---

### 2. æµ‹è¯•æ‰€æœ‰å¼‚å¸¸åœºæ™¯

**åœ¨æµè§ˆå™¨æˆ–Postmanä¸­ä¾æ¬¡æµ‹è¯•ï¼š**

```bash
# 1. æŸ¥çœ‹æ¥å£åˆ—è¡¨
GET http://localhost:8080/test/exception

# 2. æµ‹è¯•ä¸šåŠ¡å¼‚å¸¸
GET http://localhost:8080/test/exception/service
GET http://localhost:8080/test/exception/service403

# 3. æµ‹è¯•è¿è¡Œæ—¶å¼‚å¸¸
GET http://localhost:8080/test/exception/nullpointer
GET http://localhost:8080/test/exception/arrayindex
GET http://localhost:8080/test/exception/arithmetic
GET http://localhost:8080/test/exception/classcast

# 4. æµ‹è¯•æ­£å¸¸ä¸šåŠ¡
GET http://localhost:8080/test/exception/normal/0     # å‚æ•°é”™è¯¯
GET http://localhost:8080/test/exception/normal/9999  # ç”¨æˆ·ä¸å­˜åœ¨
GET http://localhost:8080/test/exception/normal/100   # æ­£å¸¸æŸ¥è¯¢

# 5. æµ‹è¯•å¼‚å¸¸é“¾
GET http://localhost:8080/test/exception/chain
```

---

### 3. æŸ¥çœ‹åç«¯æ—¥å¿—

**æ§åˆ¶å°åº”è¯¥è¾“å‡ºï¼š**
```
2025-11-05 19:45:00 [http-nio-8080-exec-1] ERROR c.h.f.e.GlobalExceptionHandler - ä¸šåŠ¡å¼‚å¸¸ï¼šç”¨æˆ·åå·²å­˜åœ¨
2025-11-05 19:45:01 [http-nio-8080-exec-2] ERROR c.h.f.e.GlobalExceptionHandler - ä¸šåŠ¡å¼‚å¸¸ï¼šæ²¡æœ‰æƒé™è®¿é—®è¯¥èµ„æº
2025-11-05 19:45:02 [http-nio-8080-exec-3] ERROR c.h.f.e.GlobalExceptionHandler - è¿è¡Œæ—¶å¼‚å¸¸ï¼š...
```

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

### ä¸šåŠ¡å¼‚å¸¸ âœ…
- [ ] ServiceException èƒ½æ­£ç¡®æŠ›å‡º
- [ ] é»˜è®¤é”™è¯¯ç 500
- [ ] è‡ªå®šä¹‰é”™è¯¯ç ç”Ÿæ•ˆ
- [ ] å¼‚å¸¸æ¶ˆæ¯æ­£ç¡®è¿”å›

### è¿è¡Œæ—¶å¼‚å¸¸ âœ…
- [ ] ç©ºæŒ‡é’ˆå¼‚å¸¸è¢«æ•è·
- [ ] æ•°ç»„è¶Šç•Œå¼‚å¸¸è¢«æ•è·
- [ ] é™¤é›¶å¼‚å¸¸è¢«æ•è·
- [ ] ç±»å‹è½¬æ¢å¼‚å¸¸è¢«æ•è·
- [ ] è¿”å›ç»Ÿä¸€å“åº”æ ¼å¼

### å…¨å±€å¤„ç† âœ…
- [ ] æ‰€æœ‰å¼‚å¸¸éƒ½è¢«æ•è·
- [ ] ä¸ä¼šè¿”å›500é”™è¯¯é¡µé¢
- [ ] è¿”å›ç»Ÿä¸€çš„JSONæ ¼å¼
- [ ] æ—¥å¿—æ­£ç¡®è®°å½•

### å®‰å…¨æ€§ âœ…
- [ ] ä¸æš´éœ²å¼‚å¸¸å †æ ˆä¿¡æ¯
- [ ] é”™è¯¯æ¶ˆæ¯ç”¨æˆ·å‹å¥½
- [ ] è¯¦ç»†é”™è¯¯è®°å½•åœ¨æ—¥å¿—ä¸­

---

## ğŸ¯ ä¸å…¶ä»–æ¨¡å—çš„å…³ç³»

### å¼‚å¸¸å¤„ç† + ç»Ÿä¸€å“åº”

```java
// æ­£å¸¸æƒ…å†µ
return AjaxResult.success(data);

// å¼‚å¸¸æƒ…å†µ
throw new ServiceException("æ“ä½œå¤±è´¥");

// GlobalExceptionHandler è‡ªåŠ¨è½¬æ¢ä¸º
return AjaxResult.error(500, "æ“ä½œå¤±è´¥");
```

---

### å¼‚å¸¸å¤„ç† + æ—¥å¿—è®°å½•

```java
// Service å±‚
public void someOperation() {
    try {
        // ä¸šåŠ¡æ“ä½œ
    } catch (Exception e) {
        log.error("æ“ä½œå¤±è´¥", e);  // è®°å½•è¯¦ç»†æ—¥å¿—
        throw new ServiceException("æ“ä½œå¤±è´¥");  // æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸
    }
}

// GlobalExceptionHandler
@ExceptionHandler(ServiceException.class)
public AjaxResult handleServiceException(ServiceException e) {
    log.error("ä¸šåŠ¡å¼‚å¸¸ï¼š{}", e.getMessage());  // è®°å½•å¼‚å¸¸
    return AjaxResult.error(e.getCode(), e.getMessage());
}
```

---

## ğŸ“š å­¦ä¹ èµ„æº

### Spring å¼‚å¸¸å¤„ç†

- [@ControllerAdvice å®˜æ–¹æ–‡æ¡£](https://spring.io/guides/tutorials/rest/)
- [@ExceptionHandler ä½¿ç”¨æŒ‡å—](https://spring.io/blog)
- [Spring MVC å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ](https://spring.io/blog)

### Java å¼‚å¸¸æœºåˆ¶

- Exception ä¸ RuntimeException çš„åŒºåˆ«
- è‡ªå®šä¹‰å¼‚å¸¸çš„è®¾è®¡
- å¼‚å¸¸é“¾çš„ä½¿ç”¨

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### ç¬¬2.5é˜¶æ®µï¼šå¸¸é‡å®šä¹‰ï¼ˆé¢„è®¡30åˆ†é’Ÿï¼‰
- [ ] Constants - é€šç”¨å¸¸é‡
- [ ] UserConstants - ç”¨æˆ·å¸¸é‡  
- [ ] CacheConstants - ç¼“å­˜å¸¸é‡

å®Œæˆåï¼Œç¬¬2é˜¶æ®µå°±å…¨éƒ¨å®Œæˆäº†ï¼ğŸ‰

---

**ğŸŠ æ­å–œå®Œæˆç¬¬2.4é˜¶æ®µï¼å¼‚å¸¸å¤„ç†ä½“ç³»æ­å»ºå®Œæˆï¼**

**å½“å‰è¿›åº¦ï¼š** ç¬¬2é˜¶æ®µå·²å®Œæˆ 80%ï¼ˆ4/5ï¼‰

**ç»§ç»­åŠ æ²¹ï¼åªå·®æœ€åä¸€æ­¥ï¼** ğŸ’ª

