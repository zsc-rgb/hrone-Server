# 📝 第4阶段准备工作

> 开始第4阶段前，需要先准备Redis环境

---

## ✅ 第4阶段概述

### 学习目标
- 集成Redis实现缓存功能
- 配置RedisTemplate和序列化器
- 掌握Redis常用数据类型操作
- 理解缓存的应用场景

### 需要准备
1. ✅ Redis服务器（5.0+）
2. ✅ Redis客户端工具（RedisDesktopManager/Another Redis Desktop Manager）
3. ✅ 第3阶段代码已完成

---

## 📦 步骤1：安装Redis（如果还没安装）

### Windows系统

**方法1：使用安装包（推荐）**

1. 下载Redis for Windows
   - GitHub地址：https://github.com/tporadowski/redis/releases
   - 下载最新版本的 Redis-x64-x.x.x.msi
   
2. 安装步骤
   ```
   - 双击安装包，按照向导安装
   - 默认安装路径：C:\Program Files\Redis
   - 勾选"Add to PATH"
   - 勾选"开机自启动"（可选）
   ```

3. 验证安装
   ```bash
   # 查看版本
   redis-server --version
   
   # 启动Redis服务
   redis-server
   ```

**方法2：使用压缩包**

1. 下载Redis压缩包
   - 下载地址：https://github.com/tporadowski/redis/releases
   - 下载 Redis-x64-x.x.x.zip

2. 解压配置
   ```
   - 解压到：D:\Redis
   - 进入目录：cd D:\Redis
   - 启动服务：redis-server.exe redis.windows.conf
   ```

3. 安装为Windows服务（可选）
   ```bash
   # 安装服务
   redis-server --service-install redis.windows.conf
   
   # 启动服务
   redis-server --service-start
   
   # 停止服务
   redis-server --service-stop
   ```

**方法3：使用Docker（推荐）**

如果你已经安装了Docker：

```bash
# 拉取Redis镜像
docker pull redis:latest

# 启动Redis容器
docker run -d --name redis -p 6379:6379 redis:latest

# 查看容器状态
docker ps
```

---

## 🔧 步骤2：启动Redis服务

### 检查Redis是否运行

```bash
# 方法1：使用redis-cli连接
redis-cli

# 如果连接成功，会显示：
# 127.0.0.1:6379>

# 测试连接
ping
# 应该返回：PONG

# 退出
exit
```

### 启动Redis服务

**Windows（已安装服务）：**
```bash
# 启动服务
net start Redis

# 或者使用redis-server命令
redis-server --service-start
```

**Windows（未安装服务）：**
```bash
# 直接启动（会占用命令行窗口）
redis-server
```

**Docker：**
```bash
# 启动容器
docker start redis
```

---

## ⚙️ 步骤3：配置Redis密码（可选）

### 修改Redis配置文件

**Windows：**

编辑 `redis.windows.conf` 文件：

```conf
# 找到以下行并取消注释，设置密码
requirepass your_password
```

**重启Redis服务使配置生效。**

### 修改项目配置

如果设置了Redis密码，需要修改项目配置：

文件：`hrone-admin/src/main/resources/application-dev.yml`

```yaml
spring:
  redis:
    password: your_password  # 修改为你设置的密码
```

**注意：** 如果没有设置密码，保持为空即可。

---

## ✅ 步骤4：验证Redis连接

### 使用redis-cli测试

```bash
# 连接Redis
redis-cli

# 如果设置了密码，需要先认证
auth your_password

# 测试基本命令
set test "Hello Redis"
get test
del test

# 查看所有key
keys *

# 退出
exit
```

**预期结果：** 所有命令正常执行 ✅

---

## 🛠️ 步骤5：安装Redis客户端工具（可选）

### 推荐工具

**1. Another Redis Desktop Manager（免费）**
- 下载地址：https://github.com/qishibo/AnotherRedisDesktopManager/releases
- 跨平台，功能强大，界面美观
- 推荐使用 ⭐⭐⭐⭐⭐

**2. RedisInsight（官方工具，免费）**
- 下载地址：https://redis.com/redis-enterprise/redis-insight/
- Redis官方出品，功能全面

**3. Redis Desktop Manager（付费）**
- 下载地址：https://resp.app/
- 功能强大，但需要付费

### 连接配置

使用客户端工具连接Redis：
- 主机：localhost
- 端口：6379
- 密码：如果设置了密码，填入密码
- 数据库：0

---

## 🧪 步骤6：测试项目连接

### 编译项目

```bash
cd d:\HroneWorking\hrone-Server
mvn clean install -DskipTests
```

**预期：** BUILD SUCCESS ✅

### 启动项目

```bash
# 方法1：使用脚本
双击：d:\HroneWorking\启动后端.bat

# 方法2：命令行
cd d:\HroneWorking\hrone-Server
mvn spring-boot:run -pl hrone-admin
```

### 查看启动日志

启动成功后，应该看到类似日志：

```
Lettuce PoolingConnectionProvider.getConnection
LettuceConnectionFactory.getConnection
```

**如果看到Redis相关日志，说明连接成功！** ✅

---

## 🔍 常见问题

### Q1: Redis服务无法启动？

**错误：** `Creating Server TCP listening socket 127.0.0.1:6379: bind: No error`

**原因：** 端口6379已被占用

**解决：**
```bash
# Windows：查找占用端口的进程
netstat -ano | findstr :6379

# 杀死进程
taskkill /F /PID <进程ID>

# 重新启动Redis
redis-server
```

---

### Q2: 连接Redis失败？

**错误：** `Unable to connect to Redis`

**检查：**
1. Redis服务是否启动：`redis-cli ping`
2. 端口是否正确：默认6379
3. 密码是否正确：检查配置文件

**解决：**
```bash
# 确认Redis正在运行
redis-cli ping
# 应该返回：PONG

# 检查端口
netstat -ano | findstr :6379
```

---

### Q3: 密码认证失败？

**错误：** `NOAUTH Authentication required`

**解决：**
1. 检查 `application-dev.yml` 中的密码配置
2. 确认Redis配置文件中的密码设置
3. 重启Redis服务和项目

---

### Q4: 项目启动报错？

**错误：** `Failed to configure a DataSource`

**原因：** 如果第3阶段的MySQL还没配置，会报这个错误

**解决方案1：** 先准备MySQL数据库（推荐）
- 按照 `第3阶段-准备工作.md` 准备MySQL

**解决方案2：** 临时排除DataSource（不推荐）
- 修改 `HROneApplication.java`，添加排除配置

---

## 📊 Redis信息

### 默认配置

| 项目 | 值 |
|------|-----|
| 主机 | localhost |
| 端口 | 6379 |
| 数据库 | 0（默认） |
| 密码 | 空（默认） |
| 连接超时 | 3000ms |
| 最大连接数 | 20 |

### Redis数据类型

第4阶段会用到的数据类型：
- **String**：字符串，最基本的类型
- **List**：列表，有序的字符串列表
- **Hash**：哈希表，键值对集合
- **Set**：集合，无序不重复元素
- **ZSet**：有序集合（第4阶段不涉及）

---

## ✅ 准备完成检查清单

完成以下检查，确保可以开始第4阶段：

- [ ] Redis已安装
- [ ] Redis服务正在运行
- [ ] 可以使用redis-cli连接
- [ ] 基本Redis命令可以执行
- [ ] （可选）Redis客户端工具已安装
- [ ] application-dev.yml配置正确
- [ ] 项目可以编译通过
- [ ] 项目可以启动（看到Redis连接日志）

**全部完成？** 开始第4阶段的学习！🚀

---

## 🎯 下一步

准备完成后：
1. 测试RedisCache工具类
2. 学习Redis的各种数据类型
3. 理解缓存的应用场景
4. 掌握过期时间设置

**查看：** `第4阶段-快速开始.md` 了解如何测试

---

**💡 提示：** 
- Redis是内存数据库，重启后数据会丢失（除非配置持久化）
- 第4阶段主要学习Redis的基本使用，不涉及持久化配置
- 测试数据不用担心丢失，可以重新创建

**加油！** 💪

